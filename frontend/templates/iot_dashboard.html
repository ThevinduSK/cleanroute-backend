<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanRoute - IoT Dashboard</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <style>
        .dashboard-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .dashboard-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            color: #00ff88;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(10, 25, 47, 0.9), rgba(17, 34, 64, 0.95));
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 20px;
        }
        
        .metric-card h3 {
            color: #00ff88;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric-value {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #8892b0;
            font-size: 0.9rem;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-row-label {
            color: #8892b0;
        }
        
        .metric-row-value {
            color: #fff;
            font-weight: 600;
        }
        
        .status-good { color: #00ff88; }
        .status-warning { color: #ffaa00; }
        .status-critical { color: #ff0055; }
        
        .protocol-badge {
            display: inline-block;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            border-radius: 20px;
            padding: 5px 15px;
            color: #00ff88;
            font-size: 0.85rem;
            margin-right: 10px;
        }
        
        .devices-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .devices-table th,
        .devices-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .devices-table th {
            color: #00ff88;
            font-weight: 600;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .devices-table td {
            color: #fff;
        }
        
        .devices-table tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }
        
        .status-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-dot.online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .status-dot.offline { background: #ff0055; }
        .status-dot.sleeping { background: #666; }
        
        .back-link {
            color: #00ff88;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #0088ff, #0066cc);
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 136, 255, 0.4);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            color: #8892b0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .feature-list li i {
            color: #00ff88;
            margin-top: 3px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #8892b0;
        }
        
        .loading i {
            font-size: 3rem;
            color: #00ff88;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-recycle"></i>
            <span class="logo-text">CLEAN<span class="highlight">ROUTE</span></span>
        </div>
        <nav class="nav-links">
            <a href="/" class="nav-link"><i class="fas fa-map"></i> Map</a>
            <a href="/districts" class="nav-link"><i class="fas fa-city"></i> Districts</a>
            <a href="/iot" class="nav-link active"><i class="fas fa-microchip"></i> IoT Dashboard</a>
        </nav>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">
                <i class="fas fa-microchip"></i> IoT Performance Dashboard
            </h1>
            <button class="refresh-btn" onclick="loadMetrics()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>

        <div id="metricsContent">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading IoT metrics...</p>
            </div>
        </div>
    </div>

    <script>
        let metricsData = null;
        let devicesData = [];
        let selectedDeviceId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadMetrics();
            loadDevices();
            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadMetrics();
                loadDevices();
            }, 30000);
        });

        async function loadMetrics() {
            try {
                const response = await fetch('/api/iot/metrics');
                metricsData = await response.json();
                renderMetrics();
            } catch (error) {
                console.error('Error loading metrics:', error);
                document.getElementById('metricsContent').innerHTML = `
                    <div class="metric-card">
                        <p style="color: #ff0055;">Failed to load metrics. Make sure the backend is running.</p>
                        <p style="color: #8892b0; margin-top: 10px;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        async function loadDevices() {
            try {
                // Use /api/bins/latest which has temperature data
                const response = await fetch('/api/bins/latest');
                devicesData = await response.json();
                // Re-render table if metrics are already loaded
                const tableBody = document.getElementById('devicesTableBody');
                if (tableBody) {
                    tableBody.innerHTML = renderDevicesTable();
                }
            } catch (error) {
                console.error('Error loading devices:', error);
            }
        }

        function renderMetrics() {
            if (!metricsData) return;

            const m = metricsData;
            const proto = m.protocol || {};
            const msg = m.message_throughput || {};
            const cmd = m.command_delivery || {};
            const dev = m.device_connectivity || {};
            const pwr = m.power_efficiency || {};
            const net = m.network_performance || {};
            const features = m.constrained_iot_features || {};

            document.getElementById('metricsContent').innerHTML = `
                <!-- Protocol Info -->
                <div style="margin-bottom: 20px;">
                    <span class="protocol-badge"><i class="fas fa-network-wired"></i> ${proto.type || 'MQTT'} v${proto.version || '3.1.1'}</span>
                    <span class="protocol-badge"><i class="fas fa-lock"></i> TLS ${proto.tls_enabled ? 'Enabled' : 'Disabled'}</span>
                    <span class="protocol-badge"><i class="fas fa-signal"></i> QoS ${proto.qos_level || 1}</span>
                    <span class="protocol-badge"><i class="fas fa-plug"></i> Port ${proto.port || 8883}</span>
                </div>

                <div class="metrics-grid">
                    <!-- Device Connectivity -->
                    <div class="metric-card">
                        <h3><i class="fas fa-broadcast-tower"></i> Device Connectivity</h3>
                        <div class="metric-value">${dev.online || 0}/${dev.total_devices || 0}</div>
                        <div class="metric-label">Devices Online</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Online Rate</span>
                                <span class="metric-row-value ${getStatusClass(dev.online_rate_pct, 80, 50)}">${dev.online_rate_pct || 0}%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Sleeping</span>
                                <span class="metric-row-value">${dev.sleeping || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Offline</span>
                                <span class="metric-row-value status-critical">${dev.offline || 0}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Message Throughput -->
                    <div class="metric-card">
                        <h3><i class="fas fa-envelope"></i> Message Throughput</h3>
                        <div class="metric-value">${msg.total_messages_24h || 0}</div>
                        <div class="metric-label">Messages (24h)</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Active Devices</span>
                                <span class="metric-row-value">${msg.active_devices || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Avg Latency</span>
                                <span class="metric-row-value">${msg.avg_latency_seconds || 0}s</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Payload Size</span>
                                <span class="metric-row-value">${msg.payload_size_estimate_bytes || 150} bytes</span>
                            </div>
                        </div>
                    </div>

                    <!-- Command Delivery -->
                    <div class="metric-card">
                        <h3><i class="fas fa-terminal"></i> Command Delivery</h3>
                        <div class="metric-value ${getStatusClass(cmd.ack_success_rate_pct, 90, 70)}">${cmd.ack_success_rate_pct || 0}%</div>
                        <div class="metric-label">ACK Success Rate</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Total Commands</span>
                                <span class="metric-row-value">${cmd.total_commands_24h || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Acknowledged</span>
                                <span class="metric-row-value status-good">${cmd.acknowledged || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Failed</span>
                                <span class="metric-row-value ${cmd.failed > 0 ? 'status-critical' : ''}">${cmd.failed || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Avg Retries</span>
                                <span class="metric-row-value">${cmd.avg_retries || 0}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Power Efficiency -->
                    <div class="metric-card">
                        <h3><i class="fas fa-battery-three-quarters"></i> Power & Battery</h3>
                        <div class="metric-value">${pwr.avg_battery_voltage || 0}V</div>
                        <div class="metric-label">Avg Battery Voltage</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Min Voltage</span>
                                <span class="metric-row-value ${pwr.min_battery_voltage < 3.5 ? 'status-critical' : ''}">${pwr.min_battery_voltage || 0}V</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Max Voltage</span>
                                <span class="metric-row-value">${pwr.max_battery_voltage || 0}V</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Critical Battery</span>
                                <span class="metric-row-value status-critical">${pwr.critical_battery_devices || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Low Battery</span>
                                <span class="metric-row-value status-warning">${pwr.low_battery_devices || 0}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Temperature Monitoring -->
                    <div class="metric-card">
                        <h3><i class="fas fa-thermometer-half"></i> Temperature Monitoring</h3>
                        <div class="metric-value ${getTempClass(m.temperature?.avg_temp_c)}">${m.temperature?.avg_temp_c || 0}°C</div>
                        <div class="metric-label">Avg Temperature</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Min Temp</span>
                                <span class="metric-row-value">${m.temperature?.min_temp_c || 0}°C</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Max Temp</span>
                                <span class="metric-row-value ${getTempClass(m.temperature?.max_temp_c)}">${m.temperature?.max_temp_c || 0}°C</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Overheating (>45°C)</span>
                                <span class="metric-row-value ${m.temperature?.overheating_devices > 0 ? 'status-critical' : ''}">${m.temperature?.overheating_devices || 0} devices</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Warm (35-45°C)</span>
                                <span class="metric-row-value status-warning">${m.temperature?.warm_readings || 0} readings</span>
                            </div>
                        </div>
                    </div>

                    <!-- Network Performance -->
                    <div class="metric-card">
                        <h3><i class="fas fa-wifi"></i> Network Performance</h3>
                        <div class="metric-value">${net.avg_rssi_dbm || 0}</div>
                        <div class="metric-label">Avg RSSI (dBm)</div>
                        <div style="margin-top: 15px;">
                            <div class="metric-row">
                                <span class="metric-row-label">Heartbeats (24h)</span>
                                <span class="metric-row-value">${net.heartbeats_24h || 0}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Min RSSI</span>
                                <span class="metric-row-value">${net.min_rssi_dbm || 0} dBm</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Avg Uptime</span>
                                <span class="metric-row-value">${net.avg_device_uptime_hours || 0}h</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Avg Free Memory</span>
                                <span class="metric-row-value">${net.avg_free_memory_kb || 0} KB</span>
                            </div>
                        </div>
                    </div>

                    <!-- Constrained IoT Features -->
                    <div class="metric-card">
                        <h3><i class="fas fa-cogs"></i> Constrained IoT Features</h3>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> ${features.lightweight_protocol || 'MQTT Protocol'}</li>
                            <li><i class="fas fa-check"></i> ${features.qos_reliability || 'QoS 1 Delivery'}</li>
                            <li><i class="fas fa-check"></i> ${features.power_management || 'Sleep/Wake Power Management'}</li>
                            <li><i class="fas fa-check"></i> ${features.message_optimization || 'Compact Payloads'}</li>
                            <li><i class="fas fa-check"></i> ${features.bandwidth_efficiency || 'Event-driven Telemetry'}</li>
                            <li><i class="fas fa-check"></i> ${features.offline_support || 'Device Shadow Support'}</li>
                            <li><i class="fas fa-check"></i> ${features.retry_mechanism || 'Command ACK/Retry'}</li>
                            <li><i class="fas fa-check"></i> ${features.ota_updates || 'OTA Firmware Updates'}</li>
                        </ul>
                    </div>
                </div>

                <!-- Devices Table -->
                <div class="metric-card" style="margin-top: 20px;">
                    <h3><i class="fas fa-list"></i> Device Status Overview</h3>
                    <table class="devices-table">
                        <thead>
                            <tr>
                                <th>Device ID</th>
                                <th>Status</th>
                                <th>Fill Level</th>
                                <th>Temperature</th>
                                <th>Battery</th>
                                <th>Last Seen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="devicesTableBody">
                            ${renderDevicesTable()}
                        </tbody>
                    </table>
                </div>
                
                <!-- Device Shadow Panel -->
                <div class="metric-card" style="margin-top: 20px;" id="shadowPanel">
                    <h3><i class="fas fa-ghost"></i> Device Shadow</h3>
                    <p style="color: #8892b0;">Select a device to view its shadow state</p>
                    <div id="shadowContent"></div>
                </div>
            `;
        }

        function renderDevicesTable() {
            if (!devicesData || devicesData.length === 0) {
                return '<tr><td colspan="7" style="text-align: center; color: #8892b0;">No devices found</td></tr>';
            }

            return devicesData.map(device => {
                // Use sleep_mode from bins/latest endpoint
                const isOnline = !device.sleep_mode && device.last_seen;
                const status = device.sleep_mode ? 'sleeping' : (isOnline ? 'online' : 'offline');
                const statusLabel = device.sleep_mode ? 'Sleeping' : (isOnline ? 'Online' : 'Offline');
                const lastSeen = device.last_seen ? new Date(device.last_seen).toLocaleString() : 'Never';
                
                // Temperature with color coding
                const temp = device.temp_c;
                let tempDisplay = 'N/A';
                let tempClass = '';
                if (temp !== null && temp !== undefined) {
                    tempDisplay = temp.toFixed(1) + '°C';
                    if (temp > 45) tempClass = 'status-critical';
                    else if (temp > 35) tempClass = 'status-warning';
                    else tempClass = 'status-good';
                }
                
                // Battery voltage to percentage (3.0V = 0%, 4.2V = 100%)
                const battV = device.batt_v || 0;
                const battPct = Math.min(100, Math.max(0, ((battV - 3.0) / 1.2) * 100));
                let battClass = battPct > 50 ? 'status-good' : (battPct > 20 ? 'status-warning' : 'status-critical');
                
                return `
                    <tr>
                        <td><strong>${device.bin_id}</strong></td>
                        <td><span class="status-dot ${status}"></span>${statusLabel}</td>
                        <td>${Math.round(device.fill_pct || 0)}%</td>
                        <td class="${tempClass}">${tempDisplay}</td>
                        <td class="${battClass}">${battV.toFixed(2)}V (${Math.round(battPct)}%)</td>
                        <td>${lastSeen}</td>
                        <td>
                            <button onclick="viewDeviceShadow('${device.bin_id}')" 
                                    style="background: #00ff88; border: none; color: #000; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-right: 5px;">
                                <i class="fas fa-ghost"></i> Shadow
                            </button>
                            <button onclick="viewDeviceDetails('${device.bin_id}')" 
                                    style="background: #0088ff; border: none; color: #fff; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                <i class="fas fa-eye"></i> Details
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getStatusClass(value, goodThreshold, warningThreshold) {
            if (value >= goodThreshold) return 'status-good';
            if (value >= warningThreshold) return 'status-warning';
            return 'status-critical';
        }
        
        function getTempClass(temp) {
            if (temp === null || temp === undefined) return '';
            if (temp > 45) return 'status-critical';
            if (temp > 35) return 'status-warning';
            return 'status-good';
        }

        function viewDeviceDetails(binId) {
            // Redirect to main dashboard with bin selected
            window.location.href = `/?bin=${binId}`;
        }
        
        async function viewDeviceShadow(binId) {
            selectedDeviceId = binId;
            const shadowContent = document.getElementById('shadowContent');
            const shadowPanel = document.getElementById('shadowPanel');
            
            // Scroll to shadow panel
            shadowPanel.scrollIntoView({ behavior: 'smooth' });
            
            shadowContent.innerHTML = '<p style="color: #8892b0;"><i class="fas fa-spinner fa-spin"></i> Loading shadow for ' + binId + '...</p>';
            
            try {
                const response = await fetch('/api/iot/device/' + binId + '/shadow');
                if (!response.ok) {
                    throw new Error('Shadow not found for device ' + binId);
                }
                const data = await response.json();
                
                const shadow = data.shadow || {};
                const delta = data.delta || {};
                const reported = shadow.reported_state || {};
                const desired = shadow.desired_state || {};
                
                shadowContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div style="background: rgba(0,255,136,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="color: #00ff88; margin-bottom: 10px;"><i class="fas fa-upload"></i> Reported State (from Device)</h4>
                            <div class="metric-row">
                                <span class="metric-row-label">Fill Level</span>
                                <span class="metric-row-value">${reported.fill_pct !== undefined ? reported.fill_pct + '%' : 'N/A'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Temperature</span>
                                <span class="metric-row-value">${reported.temp_c !== undefined ? reported.temp_c + '°C' : 'N/A'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Battery</span>
                                <span class="metric-row-value">${reported.batt_v !== undefined ? reported.batt_v + 'V' : 'N/A'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Location</span>
                                <span class="metric-row-value">${reported.lat && reported.lon ? reported.lat.toFixed(4) + ', ' + reported.lon.toFixed(4) : 'N/A'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Last Telemetry</span>
                                <span class="metric-row-value">${reported.last_telemetry ? new Date(reported.last_telemetry).toLocaleString() : 'N/A'}</span>
                            </div>
                        </div>
                        <div style="background: rgba(0,136,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="color: #0088ff; margin-bottom: 10px;"><i class="fas fa-download"></i> Desired State (from Cloud)</h4>
                            <div class="metric-row">
                                <span class="metric-row-label">Sleep Mode</span>
                                <span class="metric-row-value">${desired.sleep_mode !== undefined ? (desired.sleep_mode ? 'Yes' : 'No') : 'Not set'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Report Interval</span>
                                <span class="metric-row-value">${desired.report_interval_sec !== undefined ? desired.report_interval_sec + 's' : 'Not set'}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-row-label">Fill Threshold</span>
                                <span class="metric-row-value">${desired.fill_threshold !== undefined ? desired.fill_threshold + '%' : 'Not set'}</span>
                            </div>
                            ${Object.keys(desired).filter(k => !['sleep_mode', 'report_interval_sec', 'fill_threshold'].includes(k)).map(k => `
                                <div class="metric-row">
                                    <span class="metric-row-label">${k}</span>
                                    <span class="metric-row-value">${JSON.stringify(desired[k])}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ${Object.keys(delta).length > 0 ? `
                        <div style="background: rgba(255,170,0,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h4 style="color: #ffaa00; margin-bottom: 10px;"><i class="fas fa-sync"></i> Delta (Pending Changes)</h4>
                            <pre style="color: #fff; font-size: 0.85rem; overflow-x: auto;">${JSON.stringify(delta, null, 2)}</pre>
                        </div>
                    ` : ''}
                    <p style="color: #8892b0; margin-top: 15px; font-size: 0.85rem;">
                        <i class="fas fa-info-circle"></i> Shadow updated at: ${shadow.updated_at ? new Date(shadow.updated_at).toLocaleString() : 'Unknown'}
                    </p>
                `;
            } catch (error) {
                shadowContent.innerHTML = `
                    <p style="color: #ffaa00; margin-top: 15px;">
                        <i class="fas fa-exclamation-triangle"></i> ${error.message}
                    </p>
                    <p style="color: #8892b0; font-size: 0.85rem;">
                        Shadow will be created when the device sends its first telemetry.
                    </p>
                `;
            }
        }
    </script>
</body>
</html>
